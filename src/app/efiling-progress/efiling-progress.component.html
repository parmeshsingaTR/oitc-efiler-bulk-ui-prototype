<div class="efiling-progress-container">
  <h1>E-file Progress</h1>
      <div class="grid-container">
        <table class="data-table">
          <thead>
            <tr>
              <th class="checkbox-column">
                <mat-checkbox></mat-checkbox>
              </th>
              <th class="actions-column">Actions</th>
              <th>Efie-Progress</th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('efileStatus', $event)">
                  <span>Efile-status</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('dataset', $event)">
                  <span>Dataset</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('jurisdiction', $event)">
                  <span>Jurisdiction</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('entityName', $event)">
                  <span>Entity Name</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('returnName', $event)">
                  <span>Return Name</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('startDate', $event)">
                  <span>Start Date</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
              <th class="filter-header">
                <div class="header-content" (click)="openFilter('endDate', $event)">
                  <span>End Date</span>
                  <mat-icon class="filter-icon">arrow_drop_down</mat-icon>
                </div>
              </th>
            </tr>
          </thead>
          <tbody>
            <!-- Loop through record groups -->
            <ng-container *ngFor="let group of recordGroups">
              <!-- Group header row -->
              <tr class="group-header-row">
                <td class="checkbox-column">
                  <mat-checkbox (change)="toggleGroupSelection(group, $event.checked)" 
                                [disabled]="!hasCompletedRecords(group.records)">
                  </mat-checkbox>
                </td>
                <td colspan="9" class="group-header">
                  {{ group.name }}
                </td>
              </tr>
              
              <!-- Records for this group -->
              <tr *ngFor="let record of group.records">
                <td class="checkbox-column">
                  <mat-checkbox *ngIf="isRecordCompleted(record)" 
                                [checked]="group.selected">
                  </mat-checkbox>
                </td>
                <td class="actions-column">
                  <button mat-icon-button [matMenuTriggerFor]="rowMenu" (click)="selectedRow = record">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                </td>
                <td class="progress-cell">
                  <mat-progress-bar 
                    mode="determinate" 
                    [value]="getProgressValue(record.efileProgress, record.dataset)"
                    [ngClass]="getProgressBarClass(record.dataset, getProgressValue(record.efileProgress, record.dataset))">
                  </mat-progress-bar>
                </td>
                <td>{{ record.efileStatus }}</td>
                <td>{{ record.dataset }}</td>
                <td>{{ record.jurisdiction }}</td>
                <td>{{ record.entityName }}</td>
                <td><a href="javascript:void(0)" class="return-link">{{ record.returnName }}</a></td>
                <td>{{ record.startDate }}</td>
                <td>{{ record.endDate }}</td>
              </tr>
            </ng-container>
            
            <!-- Fallback if no groups -->
            <ng-container *ngIf="recordGroups.length === 0">
              <tr *ngFor="let record of inProgressRecords">
                <td class="checkbox-column">
                  <mat-checkbox *ngIf="isRecordCompleted(record)"></mat-checkbox>
                </td>
                <td class="actions-column">
                  <button mat-icon-button [matMenuTriggerFor]="rowMenu" (click)="selectedRow = record">
                    <mat-icon>more_vert</mat-icon>
                  </button>
                </td>
                <td class="progress-cell">
                  <mat-progress-bar 
                    mode="determinate" 
                    [value]="getProgressValue(record.efileProgress, record.dataset)"
                    [ngClass]="getProgressBarClass(record.dataset, getProgressValue(record.efileProgress, record.dataset))">
                  </mat-progress-bar>
                </td>
                <td>{{ record.efileStatus }}</td>
                <td>{{ record.dataset }}</td>
                <td>{{ record.jurisdiction }}</td>
                <td>{{ record.entityName }}</td>
                <td><a href="javascript:void(0)" class="return-link">{{ record.returnName }}</a></td>
                <td>{{ record.startDate }}</td>
                <td>{{ record.endDate }}</td>
              </tr>
            </ng-container>
          </tbody>
        </table>
      </div>
      
      <!-- Pagination controls -->
      <div class="pagination-container">
        <div class="pagination-controls">
          <button mat-icon-button class="pagination-button" [disabled]="currentPage === 1">
            <mat-icon>first_page</mat-icon>
          </button>
          <button mat-icon-button class="pagination-button" [disabled]="currentPage === 1">
            <mat-icon>chevron_left</mat-icon>
          </button>
          <button mat-icon-button class="pagination-button" [disabled]="currentPage === totalPages">
            <mat-icon>chevron_right</mat-icon>
          </button>
        </div>
        <div class="page-size-selector">
          <mat-select [value]="pageSize" class="page-size-select">
            <mat-option [value]="100">100</mat-option>
            <mat-option [value]="50">50</mat-option>
            <mat-option [value]="25">25</mat-option>
            <mat-option [value]="10">10</mat-option>
          </mat-select>
        </div>
      </div>
  
  <!-- Action menu -->
  <mat-menu #rowMenu="matMenu">
    <ng-template matMenuContent>
      <button mat-menu-item *ngFor="let item of actionMenuItems" (click)="onActionClick(item.action)">
        <mat-icon>{{item.icon}}</mat-icon>
        <span>{{item.label}}</span>
      </button>
    </ng-template>
  </mat-menu>
  
  <!-- Filter dropdown -->
  <div #filterContainer class="filter-dropdown" *ngIf="showFilter" [style.top]="filterPosition.top" [style.left]="filterPosition.left">
    <div class="filter-header">
      <div class="sort-options">
        <button class="sort-button" [class.active]="activeFilter?.sortDirection === 'asc'" (click)="setSortDirection('asc')">
          <mat-icon class="sort-icon">arrow_upward</mat-icon> Ascending
        </button>
        <button class="sort-button" [class.active]="activeFilter?.sortDirection === 'desc'" (click)="setSortDirection('desc')">
          <mat-icon class="sort-icon">arrow_downward</mat-icon> Descending
        </button>
      </div>
      
      <div class="filter-tabs">
        <div class="tab" [class.active]="activeFilter?.activeTab === 'condition'" (click)="setActiveTab('condition')">
          Filter by Condition
        </div>
        <div class="tab" [class.active]="activeFilter?.activeTab === 'value'" (click)="setActiveTab('value')">
          Filter by Value
        </div>
      </div>
    </div>
    
    <div class="filter-content">
      <!-- Filter by Value content -->
      <div *ngIf="activeFilter?.activeTab === 'value'">
        <div class="search-box">
          <input type="text" placeholder="Search" [(ngModel)]="activeFilter.searchText">
        </div>
        
        <div class="filter-options">
          <div class="option select-all">
            <mat-checkbox [checked]="areAllOptionsSelected()" 
                         [indeterminate]="areSomeOptionsSelected()"
                         (change)="toggleSelectAll($event.checked)">
              Select all
            </mat-checkbox>
          </div>
          
          <div class="option-list">
            <div class="option" *ngFor="let option of getFilteredOptions()">
              <mat-checkbox [(ngModel)]="option.selected">
                {{ option.value }}
              </mat-checkbox>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Filter by Condition content (placeholder) -->
      <div *ngIf="activeFilter?.activeTab === 'condition'">
        <div class="condition-content">
          <p>Condition filters coming soon...</p>
        </div>
      </div>
    </div>
    
    <div class="filter-actions">
      <button class="action-button apply" (click)="applyFilter()">Apply</button>
      <button class="action-button cancel" (click)="cancelFilter()">Cancel</button>
    </div>
  </div>
</div>
